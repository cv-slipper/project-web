<template>
  <div class='pie-chart'>
    <div class='trend-chart-title'>
      <div>
        数据类型分布-前端许可用量
      </div>
      <div class='info-text'>当前：{{ branchName }}</div>
      <div class='little-title'></div>
    </div>
    <div id='pieChart'></div>
  </div>
</template>

<script>
let useColor = ['#3C6BE3', '#ECD61B', '#DE430E', '#1BC78B', '#C927B8', '#0FECEE']
export default {
  name: 'PieChart',
  props: {
    branchName: {
      type: String,
      default: ''
    }
  },
  data() {
    return {
      colorIndex: 0,
      color: ['#3C6BE3', '#ECD61B', '#DE430E', '#1BC78B', '#C927B8', '#0FECEE'],
      myChart: null,
      option: {
        tooltip: {
          trigger: 'item'
        },
        legend: {
          right: 0,
          top: 'center',
          orient: 'vertical',
          icon: 'circle',
          itemWidth: 10,
          itemHeight: 10,
          formatter: name => {
            this.colorIndex++
            if (this.colorIndex > 7) {
              this.colorIndex = 1
            }
            return this.getRichArr(this.option.series[0].data, name).join('')
          },
          data: [
            {
              name: 'Search Engine',
              itemStyle: {
                color: 'white',
                borderColor: useColor[0],
                borderWidth: 3
              }
            },
            {
              name: 'Direct',
              itemStyle: {
                color: 'white',
                borderColor: useColor[1],
                borderWidth: 3
              }
            },
            {
              name: 'Email',
              itemStyle: {
                color: 'white',
                borderColor: useColor[2],
                borderWidth: 3
              }
            },
            {
              name: 'Union Ads',
              itemStyle: {
                color: 'white',
                borderColor: useColor[3],
                borderWidth: 3
              }
            },
            {
              name: 'Video Ads',
              itemStyle: {
                color: 'white',
                borderColor: useColor[4],
                borderWidth: 3
              }
            },
            {
              name: 'other',
              itemStyle: {
                color: 'white',
                borderColor: useColor[5],
                borderWidth: 3
              }
            }
          ],
          textStyle: {
            height: 15,
            lineHeight: 15,
            rich: {
              a: {
                align: 'left',
                padding: [0, 30, 0, 0],
                width: 75,
                fontSize: 12
              },
              b0: {
                align: 'right',
                color: '#3C6BE3'
              },
              b1: {
                align: 'right',
                color: '#ECD61B'
              },

              b2: {
                align: 'right',
                color: '#DE430E'
              },
              b3: {
                align: 'right',
                color: '#1BC78B'
              },
              b4: {
                align: 'right',
                color: '#C927B8'
              },
              b5: {
                align: 'right',
                color: '#0FECEE'
              },
              c: {
                width: 120,
                height: 0.5,
                borderColor: '#CAC9CA',
                borderWidth: 0.5,
                borderType: 'dashed'
              }
            }
          }
        },
        series: [
          {
            name: '',
            type: 'pie',
            color: ['#3C6BE3', '#ECD61B', '#DE430E', '#1BC78B', '#C927B8', '#0FECEE'],
            radius: ['50%', '70%'],
            center: ['27%', 'center'],
            avoidLabelOverlap: false,
            clockwise: false,
            label: {
              show: false,
              position: 'center'
            },

            emphasis: {
              label: {
                show: true,
                fontSize: '16',
                fontWeight: 'bold',
                formatter: '{d}%\n{b}'
              }
            },
            labelLine: {
              show: false
            },
            data: [
              { value: 1048, name: 'Search Engine' },
              { value: 735, name: 'Direct' },
              { value: 580, name: 'Email' },
              { value: 484, name: 'Union Ads' },
              { value: 300, name: 'Video Ads' },
              { value: 400, name: 'other' }
            ]
          }
        ]
      }
    }
  },
  methods: {
    initChart(data) {
      if (data.length > 0) {
        data.forEach((item, index) => {
          this.option.series[0].data[index].value = item.usage
          this.option.series[0].data[index].name = item.agent
          this.option.legend.data[index].name = item.agent
        })
        this.myChart = this.$echarts.init(document.getElementById('pieChart'))
        
        this.myChart.setOption(this.option)
        window.addEventListener('resize', () => {
          this.myChart.resize()
        })
      }

    },
    getRichArr(item, name) {
      let arr = []
      let index = item.findIndex(ele => ele.name == name)
      switch (index) {
        case 0:
          arr = [
            '{a|' + name + '}',
            '{b0|' + item[index].value + '}\n'
          ]
          break
        case 1:
          arr = [
            '{a|' + name + '}',
            '{b1|' + item[index].value + '}\n'
          ]
          break
        case 2:
          arr =
            [
              '{a|' + name + '}',
              '{b2|' + item[index].value + '}\n'
            ]
          break
        case 3:
          arr =
            [
              '{a|' + name + '}',
              '{b3|' + item[index].value + '}\n'
            ]
          break
        case 4:
          arr =
            [
              '{a|' + name + '}',
              '{b4|' + item[index].value + '}\n'
            ]
          break
        case 5:
          arr =
            [
              '{a|' + name + '}',
              '{b5|' + item[index].value + '} \n'
            ]
          break
      }
      index != 5 && arr.push('{c|}')
      return arr
    }
  }
}
</script>

<style scoped lang='less'>
.pie-chart {
  height: 100%;

  .trend-chart-title {
    font-size: 16px;
    font-weight: bold;
    color: #4D555E;
    padding-bottom: 10px;
    border-bottom: 1px solid #666666;
    position: relative;
    display: flex;
    justify-content: space-between;
    align-items: center;

    .info-text {
      font-weight: 400;
      color: #666666;
      font-size: 12px;
    }

    .little-title {
      width: 30px;
      height: 2px;
      background: #3C6BE3;
      position: absolute;
      left: 10%;
      bottom: 0;
    }
  }
}

#pieChart {
  width: 100%;
  height: calc(100% - 35px);
}
</style>